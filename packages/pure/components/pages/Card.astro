---
// Card.astro
import type { HTMLTag, Polymorphic } from "astro/types";
import { Image } from "astro:assets"
import { cn } from "../../utils";

type Props<Tag extends HTMLTag> = Polymorphic<{ as: Tag }> & {
  heading?: string;
  subheading?: string;
  date?: string;
  logo?: string;
  class?: string;
};

const {
  as: Tag = "div",
  class: className,
  href,
  heading,
  subheading,
  date,
  logo,
} = Astro.props;

const images = import.meta.glob<{ default: ImageMetadata }>(
  "/src/assets/experiencia/*.{jpeg,jpg,png,gif,avif,webp}"
)

if (!images[logo]) {
  throw new Error(`"${logo}" no existe en /src/assets/experiencia/`)
}
---

<Tag
  class={cn(
    `
      not-prose w-full relative rounded-2xl p-6
      backdrop-blur-md transition-colors shadow-lg

      /* Light mode */
      bg-white/60  text-zinc-700 shadow-black/5

      /* Dark mode */
      dark:bg-zinc-900/40  dark:text-zinc-200 dark:shadow-black/30
    `,
    className
  )}
  href={href}
>
  <div class="flex flex-col gap-4">

    <!-- Header -->
    <div class="flex items-center gap-3">
      {logo && (
        <Image
          src={images[logo]()}
          alt={heading}
          class="w-16 h-16 rounded-lg object-contain p-2 bg-zinc-100 border border-zinc-300/60 dark:bg-zinc-950/50 dark:border-white/10 "
        />
      )}

      <div class="flex flex-col">
        <h2 class="
          text-xl font-semibold tracking-tight

          /* Light */
          text-zinc-900

          /* Dark */
          dark:text-white
        ">
          {heading}
        </h2>

        <p class="text-primary font-medium text-sm">{subheading}</p>

        <p class="text-xs text-zinc-500 dark:text-zinc-400">{date}</p>
      </div>
    </div>

    <!-- Divider -->
    <div class="border-t border-zinc-300/40 dark:border-white/10"></div>

    <!-- Content -->
    <div class="text-left">
      <slot />
    </div>

  </div>
</Tag>
